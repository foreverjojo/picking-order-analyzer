<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <title>Excel 結構分析</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        pre {
            background: #f5f5f5;
            padding: 15px;
            overflow: auto;
            max-height: 600px;
            font-size: 12px;
        }

        h2 {
            color: #2c5530;
        }

        table {
            border-collapse: collapse;
            margin: 10px 0;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 5px 10px;
            text-align: left;
        }

        th {
            background: #2c5530;
            color: white;
        }
    </style>
</head>

<body>
    <h1>Excel 報表結構分析</h1>
    <p>請選擇 Excel 檔案：</p>
    <input type="file" id="excelFile" accept=".xlsx,.xlsm">
    <div id="output"></div>

    <script>
        document.getElementById('excelFile').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const arrayBuffer = await file.arrayBuffer();
            const workbook = new ExcelJS.Workbook();
            await workbook.xlsx.load(arrayBuffer);

            let html = '<h2>工作表列表</h2><ul>';
            workbook.worksheets.forEach((ws, index) => {
                html += `<li>${index + 1}. ${ws.name} (${ws.rowCount} 行)</li>`;
            });
            html += '</ul>';

            // 分析第 1 個工作表
            const sheet1 = workbook.worksheets[0];
            html += `<h2>工作表 1: ${sheet1.name}</h2>`;
            html += '<table><tr><th>行號</th><th>A欄</th><th>B欄</th><th>C欄</th><th>D欄</th><th>E欄</th><th>F欄</th><th>G欄</th><th>H欄</th></tr>';

            for (let i = 1; i <= Math.min(80, sheet1.rowCount); i++) {
                const row = sheet1.getRow(i);
                const cells = [];
                for (let c = 1; c <= 8; c++) {
                    const val = row.getCell(c).value;
                    cells.push(val !== null && val !== undefined ? String(val).substring(0, 20) : '');
                }
                if (cells.some(c => c)) {
                    html += `<tr><td>${i}</td>${cells.map(c => `<td>${c}</td>`).join('')}</tr>`;
                }
            }
            html += '</table>';

            // 分析第 2 個工作表
            if (workbook.worksheets.length > 1) {
                const sheet2 = workbook.worksheets[1];
                html += `<h2>工作表 2: ${sheet2.name}</h2>`;
                html += '<table><tr><th>行</th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th><th>I</th><th>J</th><th>K</th><th>L</th></tr>';

                for (let i = 1; i <= Math.min(100, sheet2.rowCount); i++) {
                    const row = sheet2.getRow(i);
                    const cells = [];
                    for (let c = 1; c <= 12; c++) {
                        const val = row.getCell(c).value;
                        cells.push(val !== null && val !== undefined ? String(val).substring(0, 12) : '');
                    }
                    if (cells.some(c => c)) {
                        html += `<tr><td>${i}</td>${cells.map(c => `<td>${c}</td>`).join('')}</tr>`;
                    }
                }
                html += '</table>';
            }

            document.getElementById('output').innerHTML = html;
        });
    </script>
</body>

</html>