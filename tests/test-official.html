<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®˜ç¶²æ’¿è²¨å–®æ¸¬è©¦</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: #1e293b;
            color: #f1f5f9;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #10b981;
            margin-bottom: 20px;
        }

        .upload-box {
            background: #334155;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            cursor: pointer;
            border: 2px dashed #64748b;
        }

        .upload-box:hover {
            border-color: #10b981;
        }

        input[type="file"] {
            display: none;
        }

        .results {
            background: #334155;
            padding: 30px;
            border-radius: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #475569;
        }

        th {
            background: #475569;
            font-weight: 600;
        }

        tr:hover {
            background: #2d3748;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #475569;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #10b981;
        }

        .stat-label {
            color: #cbd5e1;
            margin-top: 5px;
        }

        .success {
            color: #10b981;
        }

        .info {
            color: #3b82f6;
        }

        pre {
            background: #1e293b;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin-top: 15px;
        }

        .metadata {
            background: #1e293b;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }

        .metadata h4 {
            color: #3b82f6;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸŒ å®˜ç¶²æ’¿è²¨å–®è§£ææ¸¬è©¦</h1>

        <div class="upload-box" id="uploadBox">
            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“¤</div>
            <p style="font-size: 1.2em;">é»æ“Šæˆ–æ‹–æ”¾å®˜ç¶²æ’¿è²¨å–®æª”æ¡ˆ</p>
            <p style="color: #cbd5e1; margin-top: 10px;">æ”¯æ´ .xlsx æ ¼å¼</p>
            <input type="file" id="fileInput" accept=".xlsx,.xls">
        </div>

        <div class="results" id="results" style="display: none;">
            <h2>è§£æçµæœ</h2>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalRows">0</div>
                    <div class="stat-label">æª”æ¡ˆç¸½è¡Œæ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="skippedRows">6</div>
                    <div class="stat-label">è·³éçš„å…ƒæ•¸æ“šè¡Œæ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="validProducts">0</div>
                    <div class="stat-label">æœ‰æ•ˆå•†å“æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalQuantity">0</div>
                    <div class="stat-label">ç¸½æ•¸é‡</div>
                </div>
            </div>

            <div class="metadata" id="metadataSection">
                <h4>ğŸ“‹ å‰6è¡Œå…ƒæ•¸æ“šï¼ˆå·²è·³éï¼‰+ ç¬¬7è¡Œæ¨™é¡Œ</h4>
                <div id="metadataContent"></div>
            </div>

            <h3 style="margin-top: 30px;">æå–çš„å•†å“è³‡æ–™ï¼ˆå¾ç¬¬8è¡Œé–‹å§‹ï¼‰</h3>
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>åŸå§‹è¡Œè™Ÿ</th>
                        <th>å•†å“åç¨±</th>
                        <th>è¦æ ¼</th>
                        <th>æ•¸é‡</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>

            <h3 style="margin-top: 30px;">åŸå§‹ JSON è³‡æ–™ï¼ˆå‰5ç­†ï¼Œå¾ç¬¬8è¡Œé–‹å§‹ï¼‰</h3>
            <pre id="rawData"></pre>
        </div>
    </div>

    <script>
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');
        const results = document.getElementById('results');

        uploadBox.addEventListener('click', () => fileInput.click());

        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.style.borderColor = '#10b981';
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.style.borderColor = '#64748b';
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.style.borderColor = '#64748b';
            if (e.dataTransfer.files.length > 0) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            const reader = new FileReader();

            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];

                    // è®€å–æ‰€æœ‰è³‡æ–™ï¼ˆåŒ…å«å‰6è¡Œå…ƒæ•¸æ“šï¼‰
                    const allData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    // è·³éå‰6è¡Œå…ƒæ•¸æ“šï¼Œç¬¬7è¡Œæ˜¯æ¨™é¡Œï¼Œç¬¬8è¡Œé–‹å§‹æ˜¯è³‡æ–™
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {
                        range: 6  // è·³éå‰6è¡Œå…ƒæ•¸æ“šï¼Œç¬¬7è¡Œæœƒè¢«ç•¶ä½œæ¨™é¡Œ
                    });

                    console.log('ğŸ“Š æª”æ¡ˆç¸½è¡Œæ•¸:', allData.length);
                    console.log('ğŸ“‹ å‰6è¡Œå…ƒæ•¸æ“š:', allData.slice(0, 6));
                    console.log('ğŸ“Œ ç¬¬7è¡Œï¼ˆæ¨™é¡Œè¡Œï¼‰:', allData[6]);
                    console.log('ğŸ“Œ ç¬¬8è¡Œï¼ˆç¬¬ä¸€ç­†å•†å“ï¼‰:', allData[7]);
                    console.log('ğŸ“¦ å¾ç¬¬7è¡Œé–‹å§‹çš„JSONè³‡æ–™:', jsonData);
                    console.log('ğŸ” ç¬¬ä¸€ç­†å•†å“è³‡æ–™çš„æ¬„ä½:', jsonData[0] ? Object.keys(jsonData[0]) : 'ç„¡è³‡æ–™');

                    // è§£æè³‡æ–™
                    const parsed = parseOfficialData(jsonData, allData);

                    // é¡¯ç¤ºçµæœ
                    displayResults(parsed, jsonData, allData);

                } catch (error) {
                    alert('è§£æå¤±æ•—ï¼š' + error.message);
                    console.error(error);
                }
            };

            reader.readAsArrayBuffer(file);
        }

        function parseOfficialData(jsonData, allData) {
            const validProducts = [];

            jsonData.forEach((row, index) => {
                const productName = (row['å•†å“åç¨±'] || '').trim();
                const productSpec = (row['è¦æ ¼'] || '').trim();
                const quantity = parseInt(row['æ•¸é‡'] || 0);

                // åªè¦æœ‰å•†å“åç¨±å’Œæ•¸é‡å°±æå–
                if (productName && quantity > 0) {
                    validProducts.push({
                        originalRow: index + 8,  // åŸå§‹è¡Œè™Ÿï¼ˆå‰6è¡Œå…ƒæ•¸æ“š + ç¬¬7è¡Œæ¨™é¡Œ + indexï¼‰
                        name: productName,
                        spec: productSpec,
                        quantity: quantity
                    });
                }
            });

            return {
                validProducts,
                totalRows: allData.length,
                skippedRows: 6  // åªè·³éå‰6è¡Œå…ƒæ•¸æ“š
            };
        }

        function displayResults(parsed, jsonData, allData) {
            results.style.display = 'block';

            // çµ±è¨ˆè³‡æ–™
            document.getElementById('totalRows').textContent = parsed.totalRows;
            document.getElementById('skippedRows').textContent = parsed.skippedRows;
            document.getElementById('validProducts').textContent = parsed.validProducts.length;

            const totalQty = parsed.validProducts.reduce((sum, p) => sum + p.quantity, 0);
            document.getElementById('totalQuantity').textContent = totalQty;

            // é¡¯ç¤ºå‰6è¡Œå…ƒæ•¸æ“š + ç¬¬7è¡Œæ¨™é¡Œ
            const metadataDiv = document.getElementById('metadataContent');
            let metadataHTML = '<ul>';
            allData.slice(0, 6).forEach((row, i) => {
                metadataHTML += `<li style="color: #cbd5e1;">ç¬¬ ${i + 1} è¡Œ: ${JSON.stringify(row)}</li>`;
            });
            metadataHTML += `<li style="color: #3b82f6;"><strong>ç¬¬ 7 è¡Œï¼ˆæ¨™é¡Œï¼‰: ${JSON.stringify(allData[6])}</strong></li>`;
            metadataHTML += '</ul>';

            // é¡¯ç¤ºåµæ¸¬åˆ°çš„æ¬„ä½
            if (jsonData.length > 0) {
                const fields = Object.keys(jsonData[0]);
                metadataHTML += `<div style="margin-top: 15px; padding: 10px; background: #475569; border-radius: 6px;">
                    <strong style="color: #10b981;">âœ“ åµæ¸¬åˆ°çš„æ¬„ä½ï¼š</strong><br>
                    ${fields.map(f => `<span style="color: #cbd5e1;">"${f}"</span>`).join(', ')}
                </div>`;
            } else {
                metadataHTML += `<div style="margin-top: 15px; padding: 10px; background: #ef4444; border-radius: 6px;">
                    <strong>âš ï¸ è­¦å‘Šï¼šå¾ç¬¬8è¡Œé–‹å§‹æ²’æœ‰è®€å–åˆ°ä»»ä½•è³‡æ–™ï¼</strong>
                </div>`;
            }

            metadataDiv.innerHTML = metadataHTML;

            // å•†å“è¡¨æ ¼
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (parsed.validProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #f59e0b;">âš ï¸ æ²’æœ‰æå–åˆ°ä»»ä½•å•†å“è³‡æ–™ï¼Œè«‹æª¢æŸ¥ConsoleæŸ¥çœ‹è©³ç´°è³‡è¨Š</td></tr>';
            } else {
                parsed.validProducts.forEach(product => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>ç¬¬ ${product.originalRow} è¡Œ</td>
                        <td>${product.name}</td>
                        <td>${product.spec}</td>
                        <td><strong>${product.quantity}</strong></td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // åŸå§‹è³‡æ–™ï¼ˆå¾ç¬¬8è¡Œé–‹å§‹çš„å‰5ç­†ï¼‰
            document.getElementById('rawData').textContent =
                JSON.stringify(jsonData.slice(0, 5), null, 2);
        }
    </script>
</body>

</html>
```