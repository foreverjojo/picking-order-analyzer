<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOMO æ’¿è²¨å–®æ¸¬è©¦</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: #1e293b;
            color: #f1f5f9;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #f59e0b;
            margin-bottom: 20px;
        }

        .upload-box {
            background: #334155;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            cursor: pointer;
            border: 2px dashed #64748b;
        }

        .upload-box:hover {
            border-color: #f59e0b;
        }

        input[type="file"] {
            display: none;
        }

        .results {
            background: #334155;
            padding: 30px;
            border-radius: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #475569;
        }

        th {
            background: #475569;
            font-weight: 600;
        }

        tr:hover {
            background: #2d3748;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #475569;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #10b981;
        }

        .stat-label {
            color: #cbd5e1;
            margin-top: 5px;
        }

        .success {
            color: #10b981;
        }

        .warning {
            color: #f59e0b;
        }

        pre {
            background: #1e293b;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin-top: 15px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ“Š MOMO æ’¿è²¨å–®è§£ææ¸¬è©¦</h1>

        <div class="upload-box" id="uploadBox">
            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“¤</div>
            <p style="font-size: 1.2em;">é»æ“Šæˆ–æ‹–æ”¾ MOMO æ’¿è²¨å–®æª”æ¡ˆ</p>
            <p style="color: #cbd5e1; margin-top: 10px;">æ”¯æ´ .xlsx æ ¼å¼</p>
            <input type="file" id="fileInput" accept=".xlsx,.xls">
        </div>

        <div class="results" id="results" style="display: none;">
            <h2>è§£æçµæœ</h2>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalRows">0</div>
                    <div class="stat-label">ç¸½è¡Œæ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="validProducts">0</div>
                    <div class="stat-label">æœ‰æ•ˆå•†å“æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="filteredRows">0</div>
                    <div class="stat-label">éæ¿¾æ‰çš„è¡Œæ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalQuantity">0</div>
                    <div class="stat-label">ç¸½æ•¸é‡</div>
                </div>
            </div>

            <h3 style="margin-top: 30px;">æå–çš„å•†å“è³‡æ–™</h3>
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>å•†å“åç¨±</th>
                        <th>å–®å“è¦æ ¼</th>
                        <th>æ’¿è²¨æ•¸é‡</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>

            <h3 style="margin-top: 30px;">éæ¿¾æ‰çš„è³‡æ–™</h3>
            <div id="filteredData"></div>

            <h3 style="margin-top: 30px;">åŸå§‹ JSON è³‡æ–™ï¼ˆå‰5ç­†ï¼‰</h3>
            <pre id="rawData"></pre>
        </div>
    </div>

    <script>
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');
        const results = document.getElementById('results');

        uploadBox.addEventListener('click', () => fileInput.click());

        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.style.borderColor = '#f59e0b';
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.style.borderColor = '#64748b';
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.style.borderColor = '#64748b';
            if (e.dataTransfer.files.length > 0) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            const reader = new FileReader();

            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);

                    console.log('åŸå§‹è³‡æ–™:', jsonData);

                    // è§£æè³‡æ–™
                    const parsed = parseMomoData(jsonData);

                    // é¡¯ç¤ºçµæœ
                    displayResults(parsed, jsonData);

                } catch (error) {
                    alert('è§£æå¤±æ•—ï¼š' + error.message);
                    console.error(error);
                }
            };

            reader.readAsArrayBuffer(file);
        }

        function parseMomoData(jsonData) {
            const validProducts = [];
            const filteredRows = [];

            jsonData.forEach((row, index) => {
                const productName = row['å•†å“åç¨±'] || '';
                const productSpec = row['å–®å“è¦æ ¼'] || '';
                const quantity = parseInt(row['æ’¿è²¨æ•¸é‡'] || 0);

                // æª¢æŸ¥æ˜¯å¦éœ€è¦éæ¿¾
                const shouldFilter =
                    productName.includes('é‹è²»') ||
                    !productName ||
                    quantity <= 0;

                if (shouldFilter) {
                    filteredRows.push({
                        index: index + 1,
                        productName: productName,
                        reason: !productName ? 'ç©ºç™½å•†å“åç¨±' :
                            productName.includes('é‹è²»') ? 'é‹è²»è¡Œ' :
                                'æ•¸é‡ç‚º0æˆ–è² æ•¸'
                    });
                } else {
                    validProducts.push({
                        index: index + 1,
                        name: productName,
                        spec: productSpec,
                        quantity: quantity
                    });
                }
            });

            return {
                validProducts,
                filteredRows,
                totalRows: jsonData.length
            };
        }

        function displayResults(parsed, rawData) {
            results.style.display = 'block';

            // çµ±è¨ˆè³‡æ–™
            document.getElementById('totalRows').textContent = parsed.totalRows;
            document.getElementById('validProducts').textContent = parsed.validProducts.length;
            document.getElementById('filteredRows').textContent = parsed.filteredRows.length;

            const totalQty = parsed.validProducts.reduce((sum, p) => sum + p.quantity, 0);
            document.getElementById('totalQuantity').textContent = totalQty;

            // å•†å“è¡¨æ ¼
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            parsed.validProducts.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.index}</td>
                    <td>${product.name}</td>
                    <td>${product.spec}</td>
                    <td><strong>${product.quantity}</strong></td>
                `;
                tbody.appendChild(row);
            });

            // éæ¿¾æ‰çš„è³‡æ–™
            const filteredDiv = document.getElementById('filteredData');
            if (parsed.filteredRows.length > 0) {
                filteredDiv.innerHTML = '<ul>' +
                    parsed.filteredRows.map(f =>
                        `<li>ç¬¬ ${f.index} è¡Œ: <span class="warning">${f.productName || '(ç©ºç™½)'}</span> - ${f.reason}</li>`
                    ).join('') +
                    '</ul>';
            } else {
                filteredDiv.innerHTML = '<p class="success">âœ“ æ²’æœ‰éœ€è¦éæ¿¾çš„è³‡æ–™</p>';
            }

            // åŸå§‹è³‡æ–™
            document.getElementById('rawData').textContent =
                JSON.stringify(rawData.slice(0, 5), null, 2);
        }
    </script>
</body>

</html>