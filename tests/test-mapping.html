<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹å‹•å°æ‡‰å·¥å…·</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: #1e293b;
            color: #f1f5f9;
            padding: 20px;
        }

        .container {
            max-width: 1900px;
            margin: 0 auto;
        }

        h1 {
            color: #f59e0b;
            margin-bottom: 20px;
        }

        .upload-section {
            background: #334155;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .upload-box {
            display: inline-block;
            background: #475569;
            padding: 20px 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px dashed #64748b;
            margin: 10px;
        }

        .upload-box:hover {
            border-color: #f59e0b;
        }

        input[type="file"] {
            display: none;
        }

        .mapping-area {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background: #334155;
            padding: 20px;
            border-radius: 12px;
        }

        .panel h2 {
            color: #f59e0b;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .product-list {
            max-height: 700px;
            overflow-y: auto;
        }

        .picking-item {
            background: #475569;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .picking-item:hover {
            background: #5a6a7d;
        }

        .picking-item.selected {
            border-color: #f59e0b;
            background: #5a6a7d;
        }

        .template-item {
            background: #475569;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 6px;
        }

        .template-product-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: #10b981;
        }

        .spec-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .spec-btn {
            padding: 6px 12px;
            background: #334155;
            border: 1px solid #64748b;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
        }

        .spec-btn:hover {
            background: #475569;
            border-color: #f59e0b;
        }

        .mapped-item {
            background: #475569;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 4px solid #10b981;
        }

        .mapped-item small {
            color: #94a3b8;
            display: block;
            margin-top: 4px;
        }

        .remove-btn {
            float: right;
            color: #ef4444;
            cursor: pointer;
            padding: 2px 8px;
        }

        .remove-btn:hover {
            background: #7f1d1d;
            border-radius: 4px;
        }

        .export-btn {
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px;
        }

        .export-btn:hover {
            background: #059669;
        }

        .stats {
            background: #475569;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”— æ‰‹å‹•å°æ‡‰å·¥å…·</h1>

        <div class="upload-section">
            <h3 style="margin-bottom: 15px;">ä¸Šå‚³æª”æ¡ˆ</h3>
            <div class="upload-box" onclick="document.getElementById('pickingInput').click()">
                <div>ğŸ“¦ ä¸Šå‚³æ’¿è²¨å–®</div>
                <small style="color: #94a3b8;">MOMO/å®˜ç¶² Excel æˆ– è¦çš® PDF</small>
                <input type="file" id="pickingInput" accept=".xlsx,.pdf">
            </div>
            <button class="export-btn" onclick="exportMappings()">ğŸ’¾ åŒ¯å‡ºå°æ‡‰é—œä¿‚</button>
            <button class="export-btn" style="background: #3b82f6;" onclick="clearMappings()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰å°æ‡‰</button>
        </div>

        <div class="mapping-area">
            <div class="panel">
                <h2>ğŸ“¦ æ’¿è²¨å–®å•†å“</h2>
                <div class="stats" id="pickingStats" style="display: none;">
                    <strong>ç¸½æ•¸ï¼š</strong><span id="pickingCount">0</span>
                </div>
                <div class="product-list" id="pickingList">
                    <p style="color: #94a3b8; padding: 20px; text-align: center;">è«‹ä¸Šå‚³æ’¿è²¨å–®</p>
                </div>
            </div>

            <div class="panel">
                <h2>ğŸ“Š å ±è¡¨å•†å“èˆ‡è¦æ ¼</h2>
                <div class="stats">
                    å·²è¼‰å…¥ <span id="templateCount">0</span> å€‹å•†å“æ¨¡æ¿
                </div>
                <div class="product-list" id="templateList"></div>
            </div>

            <div class="panel">
                <h2>âœ… å·²å°æ‡‰æ¸…å–®</h2>
                <div class="stats" id="mappedStats">
                    å·²å°æ‡‰ï¼š<span id="mappedCount">0</span> å€‹
                </div>
                <div class="product-list" id="mappedList">
                    <p style="color: #94a3b8; padding: 20px; text-align: center;">å°šç„¡å°æ‡‰</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // ç›´æ¥åµŒå…¥å•†å“è¦æ ¼é…ç½®
        const productMapping = {
            "è±†å¡”-è”“è¶Šè“": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "è±†å¡”-ç„¦ç³–": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "è±†å¡”-å·§å…‹åŠ›": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "è±†å¡”-æŠ¹èŒ¶": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "è±†å¡”-æ¤’éº»": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "å …æœå¡”-èœ‚èœœ": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "å …æœå¡”-ç„¦ç³–": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "å …æœå¡”-å·§å…‹åŠ›": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "å …æœå¡”-æµ·è‹”": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "å …æœå¡”-å’–å“©": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "è±†å¡”-ç¶œåˆ": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "å …æœå¡”-ç¶œåˆ": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "é›™å¡”": { "columns": { "B": "10å…¥è¢‹è£", "D": "å–®é¡†" } },
            "åœŸé³³æ¢¨é…¥(ç´…é»)": { "columns": { "B": "8å…¥è¢‹è£", "C": "12å…¥è¢‹è£" } },
            "é³³å‡°é…¥": { "columns": { "B": "8å…¥è¢‹è£", "C": "12å…¥è¢‹è£" } },
            "é›ªèŠ±é¤…-ç¶œåˆ": { "columns": { "B": "10å…¥è¢‹è£", "C": "15å…¥è¢‹è£", "D": "å–®å€‹" } },
            "é›ªèŠ±é¤…-è”“è¶Šè“": { "columns": { "B": "10å…¥è¢‹è£", "C": "15å…¥è¢‹è£", "D": "å–®å€‹" } },
            "é›ªèŠ±é¤…-å·§å…‹åŠ›": { "columns": { "B": "10å…¥è¢‹è£", "C": "15å…¥è¢‹è£", "D": "å–®å€‹" } },
            "é›ªèŠ±é¤…-é‡‘æ²™": { "columns": { "B": "10å…¥è¢‹è£", "C": "15å…¥è¢‹è£", "D": "å–®å€‹" } },
            "é›ªèŠ±é¤…-æŠ¹èŒ¶": { "columns": { "B": "10å…¥è¢‹è£", "C": "15å…¥è¢‹è£", "D": "å–®å€‹" } },
            "é›ªèŠ±é¤…-è‚‰é¬†": { "columns": { "B": "10å…¥è¢‹è£", "C": "15å…¥è¢‹è£", "D": "å–®å€‹" } },
            "ç‘ªå¾·è“®-ç¶œåˆ": { "columns": { "B": "10å…¥è¢‹è£", "C": "å–®å€‹" } },
            "ç‘ªå¾·è“®-èœ‚èœœ": { "columns": { "B": "10å…¥è¢‹è£", "C": "å–®å€‹" } },
            "ç‘ªå¾·è“®-å·§å…‹åŠ›": { "columns": { "B": "10å…¥è¢‹è£", "C": "å–®å€‹" } },
            "ç‘ªå¾·è“®-ç´…èŒ¶": { "columns": { "B": "10å…¥è¢‹è£", "C": "å–®å€‹" } },
            "ç‘ªå¾·è“®-æŠ¹èŒ¶": { "columns": { "B": "10å…¥è¢‹è£", "C": "å–®å€‹" } },
            "ç‘ªå¾·è“®-æŸ‘æ©˜": { "columns": { "B": "10å…¥è¢‹è£", "C": "å–®å€‹" } },
            "ç‘ªå¾·è“®-æª¸æª¬": { "columns": { "B": "10å…¥è¢‹è£", "C": "å–®å€‹" } },
            "ç„¡èª¿å‘³ç¶œåˆå …æœ": { "columns": { "B": "120g", "C": "280g" } },
            "ç„¡èª¿å‘³å¤å¨å¤·è±†": { "columns": { "B": "120g", "C": "280g" } },
            "ç„¡èª¿å‘³è…°æœ": { "columns": { "B": "120g", "C": "280g" } },
            "ç„¡èª¿å‘³æä»": { "columns": { "B": "120g", "C": "280g" } },
            "ç„¡èª¿å‘³æ ¸æ¡ƒ": { "columns": { "B": "120g", "C": "280g" } },
            "â˜…ä¸­æ±æ¤°æ£—300g": { "columns": { "B": "300g" } },
            "æ¤°æ£—è±†å­150g": { "columns": { "B": "150g" } },
            "æ¤°æ£—è…°æœ150g": { "columns": { "B": "150g" } },
            "æ¤°æ£—æä»150g": { "columns": { "B": "150g" } },
            "æ¤°æ£—æ ¸æ¡ƒ150g": { "columns": { "B": "150g" } },
            "ç‰›å¥¶ç³–": { "columns": { "C": "200g" } },
            "ç‰›å¥¶ç³–-50g": { "columns": { "B": "50g" } },
            "å—æ£—æ ¸æ¡ƒç³•": { "columns": { "C": "200g" } },
            "ç“¦ç‰‡-ç¶œåˆ": { "columns": { "B": "90g", "C": "135g" } },
            "ç“¦ç‰‡-åŸå‘³": { "columns": { "B": "90g", "C": "135g" } },
            "ç“¦ç‰‡-åŸå‘³45å…‹": { "columns": { "B": "45g" } },
            "ç“¦ç‰‡-ç´…èŒ¶": { "columns": { "B": "90g", "C": "135g" } },
            "ç“¦ç‰‡-å·§å…‹åŠ›": { "columns": { "B": "90g", "C": "135g" } },
            "ç“¦ç‰‡-æµ·è‹”": { "columns": { "B": "90g", "C": "135g" } },
            "ç“¦ç‰‡-æŠ¹èŒ¶": { "columns": { "B": "90g", "C": "135g" } },
            "ç“¦ç‰‡-é»‘ç³–": { "columns": { "B": "90g", "C": "135g" } },
            "ç“¦ç‰‡-é’èŠ±æ¤’": { "columns": { "B": "90g", "C": "135g" } },
            "å¥¶æ²¹-ç„¦ç³–ç‰›å¥¶": { "columns": { "B": "90g", "C": "135g" } },
            "å¥¶æ²¹-æ³•åœ‹å·§å…‹åŠ›": { "columns": { "B": "90g", "C": "135g" } },
            "å¥¶æ²¹-èœ‚èœœæª¸æª¬": { "columns": { "B": "90g", "C": "135g" } },
            "å¥¶æ²¹-ä¼¯çˆµç´…èŒ¶": { "columns": { "B": "90g", "C": "135g" } },
            "å¥¶æ²¹-æŠ¹èŒ¶": { "columns": { "B": "90g", "C": "135g" } },
            "è¥¿é»-ç¶œåˆ": { "columns": { "B": "90g", "C": "135g" } },
            "è¥¿é»-å·§å…‹åŠ›è²æ®¼": { "columns": { "B": "90g", "C": "135g" } },
            "è¥¿é»-å’–å•¡å°èŠ±": { "columns": { "B": "90g", "C": "135g" } },
            "è¥¿é»-è—è“å°èŠ±": { "columns": { "B": "90g", "C": "135g" } },
            "è¥¿é»-è”“è¶Šè“è²æ®¼": { "columns": { "B": "90g", "C": "135g" } },
            "è¥¿é»-ä¹³é…ªé…¥æ¢": { "columns": { "B": "90g", "C": "135g" } },
            "é›™å¡”ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "è”“è¶Šè“ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "ç¶œè±†ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "ç¶œå …ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "æ™´ç©ºå¡”é¤…ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "æš–æš–å¹¸ç¦ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "è‡»æ„›æ™‚å…‰ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "æ¿ƒæƒ…æ»¿è¼‰ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "æµªæ¼«è©©ç¯‡ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "æˆ€æˆ€é›ªèŠ±ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "åˆå¾Œæ¼«æ­¥ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "é‚£å¹´èŠ±é–‹ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "èŠ±é–“é€¸éŸ»ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "è¼•-é¦™æ¦­æ¼«éŠç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "è¼•-æ™¨æ›¦ç‰©èªç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "è¼•-é‡‘ç·»å…¸è—ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } },
            "è¼•-æœˆå…‰åºæ›²ç¦®ç›’": { "columns": { "B": "ç¦®ç›’" } }
        };

        let pickingProducts = [];
        let mappings = [];
        let selectedPickingIndex = null;
        let nextPickingIndex = 0; // ç”¨æ–¼çµ¦æ–°å•†å“åˆ†é…å”¯ä¸€ID

        // åˆå§‹åŒ–æ™‚é¡¯ç¤ºæ¨¡æ¿å•†å“
        displayTemplateProducts();

        document.getElementById('pickingInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            let newProducts = [];
            if (file.name.endsWith('.pdf')) {
                newProducts = await parseShopeePDF(file);
            } else {
                newProducts = await parseExcel(file);
            }

            // ç´¯åŠ æ¨¡å¼ï¼šå°‡æ–°å•†å“åŠ å…¥ç¾æœ‰åˆ—è¡¨
            newProducts.forEach(p => {
                p.index = nextPickingIndex++;
                pickingProducts.push(p);
            });

            displayPickingProducts();

            // æ¸…ç©ºinputï¼Œå…è¨±é‡è¤‡ä¸Šå‚³åŒä¸€æª”æ¡ˆ
            e.target.value = '';
        });

        async function parseExcel(file) {
            const arrayBuffer = await file.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];

            // æª¢æ¸¬æ˜¯å¦ç‚ºå®˜ç¶²ï¼ˆå‰6è¡Œæ˜¯å…ƒæ•¸æ“šï¼‰
            const isOfficial = workbook.SheetNames[0].includes('å®˜ç¶²') || file.name.includes('å®˜ç¶²');
            const data = XLSX.utils.sheet_to_json(worksheet, {
                range: isOfficial ? 6 : 0
            });

            return data.map(row => ({
                name: row['å•†å“åç¨±'] || '',
                spec: row['å–®å“è¦æ ¼'] || row['è¦æ ¼'] || '',
                quantity: parseInt(row['æ’¿è²¨æ•¸é‡'] || row['æ•¸é‡'] || 0)
            })).filter(p => p.name && p.quantity > 0 && !p.name.includes('é‹è²»'));
        }

        async function parseShopeePDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

            const allProducts = [];
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageItems = textContent.items.map(item => ({
                    text: item.str.trim(),
                    x: Math.round(item.transform[4]),
                    y: Math.round(item.transform[5])
                }));

                const products = parseShopeePage(pageItems);
                allProducts.push(...products);
            }

            return allProducts;
        }

        function parseShopeePage(items) {
            const rows = groupByY(items);
            const columnRanges = {
                seq: { min: 32, max: 59 },
                productName: { min: 166, max: 307 },
                spec: { min: 308, max: 396 },
                quantity: { min: 397, max: 520 }
            };

            let headerY = null;
            for (let row of rows) {
                if (row.items.some(i => i.text.includes('å•†å“åç¨±'))) {
                    headerY = row.y;
                    break;
                }
            }

            if (!headerY) return [];

            const products = [];
            let currentProduct = null;

            rows.forEach(row => {
                if (row.y >= headerY) return;

                let seqNum = null;
                row.items.forEach(item => {
                    if (item.x >= columnRanges.seq.min && item.x <= columnRanges.seq.max) {
                        const num = parseInt(item.text.trim());
                        if (!isNaN(num) && num > 0) seqNum = num;
                    }
                });

                if (seqNum) {
                    if (currentProduct) products.push(currentProduct);
                    currentProduct = { seq: seqNum, name: [], spec: [], quantity: null };
                }

                if (currentProduct) {
                    const rowText = row.items.map(i => i.text).join(' ');
                    if (rowText.includes('åˆè¨ˆ')) return;

                    row.items.forEach(item => {
                        const x = item.x;
                        const t = item.text.trim();

                        if (x >= columnRanges.productName.min && x <= columnRanges.productName.max) {
                            if (!t.match(/^\d+$/)) currentProduct.name.push(t);
                        } else if (x >= columnRanges.spec.min && x <= columnRanges.spec.max) {
                            if (!t.match(/^\d+$/)) currentProduct.spec.push(t);
                        } else if (x >= columnRanges.quantity.min && x <= columnRanges.quantity.max) {
                            const num = parseInt(t);
                            if (!isNaN(num) && num > 0) currentProduct.quantity = num;
                        }
                    });
                }
            });

            if (currentProduct) products.push(currentProduct);

            return products.filter(p => p.seq && p.seq > 0).map(p => ({
                name: p.name.join(' '),
                spec: p.spec.join(' '),
                quantity: p.quantity || 0
            }));
        }

        function groupByY(items, tolerance = 5) {
            const sorted = [...items].sort((a, b) => b.y - a.y);
            const groups = [];
            sorted.forEach(item => {
                let found = false;
                for (let g of groups) {
                    if (Math.abs(g.y - item.y) <= tolerance) {
                        g.items.push(item);
                        found = true;
                        break;
                    }
                }
                if (!found) groups.push({ y: item.y, items: [item] });
            });
            groups.forEach(g => g.items.sort((a, b) => a.x - b.x));
            return groups;
        }

        function displayPickingProducts() {
            document.getElementById('pickingStats').style.display = 'block';
            document.getElementById('pickingCount').textContent = pickingProducts.length;

            const list = document.getElementById('pickingList');
            list.innerHTML = pickingProducts.map((p, i) => `
                <div class="picking-item ${selectedPickingIndex === i ? 'selected' : ''}" 
                     onclick="selectPickingProduct(${i})"
                     id="picking-${i}">
                    <div style="font-weight: 600;">${p.name}</div>
                    <div style="color: #94a3b8; font-size: 0.85em; margin-top: 4px;">
                        è¦æ ¼: ${p.spec || '(ç„¡)'} | æ•¸é‡: ${p.quantity}
                    </div>
                </div>
            `).join('');
        }

        function displayTemplateProducts() {
            const sorted = Object.keys(productMapping).sort();
            document.getElementById('templateCount').textContent = sorted.length;

            const list = document.getElementById('templateList');
            list.innerHTML = sorted.map(productName => {
                const specs = productMapping[productName].columns;
                return `
                    <div class="template-item">
                        <div class="template-product-name">${productName}</div>
                        <div class="spec-buttons">
                            ${Object.entries(specs).map(([col, specName]) => `
                                <div class="spec-btn" 
                                     onclick="createMapping('${productName}', '${col}', '${specName}')">
                                    æ¬„${col}: ${specName}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectPickingProduct(index) {
            selectedPickingIndex = index;
            displayPickingProducts();
        }

        function createMapping(productName, column, specName) {
            if (selectedPickingIndex === null) {
                alert('è«‹å…ˆé¸æ“‡æ’¿è²¨å–®å•†å“');
                return;
            }

            const picking = pickingProducts[selectedPickingIndex];

            mappings.push({
                pickingName: picking.name,
                pickingSpec: picking.spec,
                pickingQuantity: picking.quantity,
                templateProduct: productName,
                templateColumn: column,
                templateSpec: specName
            });

            // å–æ¶ˆé¸æ“‡
            selectedPickingIndex = null;
            displayPickingProducts();
            displayMappedList();
        }

        function displayMappedList() {
            document.getElementById('mappedCount').textContent = mappings.length;

            const list = document.getElementById('mappedList');
            if (mappings.length === 0) {
                list.innerHTML = '<p style="color: #94a3b8; padding: 20px; text-align: center;">å°šç„¡å°æ‡‰</p>';
                return;
            }

            list.innerHTML = mappings.map((m, i) => `
                <div class="mapped-item">
                    <span class="remove-btn" onclick="removeMapping(${i})">âœ•</span>
                    <div style="font-weight: 600;">${m.pickingName}</div>
                    <small>æ’¿è²¨å–®è¦æ ¼: ${m.pickingSpec} | æ•¸é‡: ${m.pickingQuantity}</small>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #334155;">
                        <strong style="color: #10b981;">â†’ ${m.templateProduct}</strong>
                        <small style="display: block;">æ¬„${m.templateColumn}: ${m.templateSpec}</small>
                    </div>
                </div>
            `).join('');
        }

        function removeMapping(index) {
            mappings.splice(index, 1);
            displayMappedList();
        }

        function exportMappings() {
            const dataStr = JSON.stringify(mappings, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mapping-${new Date().getTime()}.json`;
            a.click();
        }

        function clearMappings() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å°æ‡‰é—œä¿‚å—ï¼Ÿ')) {
                mappings = [];
                displayMappedList();
            }
        }
    </script>
</body>

</html>