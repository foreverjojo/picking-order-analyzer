<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å ±è¡¨ç¯„æœ¬åˆ†æå·¥å…·</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: #1e293b;
            color: #f1f5f9;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            color: #10b981;
            margin-bottom: 20px;
        }

        .upload-box {
            background: #334155;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            cursor: pointer;
            border: 2px dashed #64748b;
        }

        .upload-box:hover {
            border-color: #10b981;
        }

        input[type="file"] {
            display: none;
        }

        .results {
            background: #334155;
            padding: 30px;
            border-radius: 12px;
        }

        .info-card {
            background: #475569;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-card h3 {
            color: #10b981;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #475569;
            font-size: 0.9em;
        }

        th {
            background: #475569;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #2d3748;
        }

        .table-container {
            max-height: 500px;
            overflow-y: auto;
        }

        pre {
            background: #0f172a;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.85em;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ“Š å ±è¡¨ç¯„æœ¬åˆ†æå·¥å…·</h1>

        <div class="upload-box" id="uploadBox">
            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“¤</div>
            <p style="font-size: 1.2em;">é»æ“Šæˆ–æ‹–æ”¾å ±è¡¨ç¯„æœ¬æª”æ¡ˆ</p>
            <p style="color: #cbd5e1; margin-top: 10px;">æ”¯æ´ .xlsx å’Œ .xlsm æ ¼å¼</p>
            <input type="file" id="fileInput" accept=".xlsx,.xlsm">
        </div>

        <div class="results" id="results" style="display: none;">
            <div class="info-card">
                <h3>ğŸ“‹ åŸºæœ¬è³‡è¨Š</h3>
                <p><strong>æª”æ¡ˆåç¨±ï¼š</strong><span id="fileName"></span></p>
                <p><strong>å·¥ä½œè¡¨æ•¸é‡ï¼š</strong><span id="sheetCount"></span></p>
                <p><strong>å·¥ä½œè¡¨åç¨±ï¼š</strong><span id="sheetNames"></span></p>
            </div>

            <div class="info-card">
                <h3>ğŸ·ï¸ åˆ—Aå•†å“åç¨±æ¸…å–®</h3>
                <p style="margin-bottom: 10px;">é¸æ“‡å·¥ä½œè¡¨ï¼š
                    <select id="productSheetSelector"
                        style="padding: 5px; background: #334155; color: #f1f5f9; border: 1px solid #64748b; border-radius: 4px;">
                    </select>
                </p>
                <div
                    style="background: #0f172a; padding: 15px; border-radius: 6px; max-height: 400px; overflow-y: auto;">
                    <div id="productList"></div>
                </div>
            </div>

            <div class="info-card">
                <h3>ğŸ“‘ å·¥ä½œè¡¨å…§å®¹é è¦½</h3>
                <p style="margin-bottom: 10px;">é¸æ“‡å·¥ä½œè¡¨ï¼š
                    <select id="sheetSelector"
                        style="padding: 5px; background: #334155; color: #f1f5f9; border: 1px solid #64748b; border-radius: 4px;">
                    </select>
                </p>
                <div class="table-container">
                    <table id="previewTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>

            <div class="info-card">
                <h3>ğŸ” è³‡æ–™çµæ§‹åˆ†æ</h3>
                <pre id="analysisResult"></pre>
            </div>
        </div>
    </div>

    <script>
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');
        let workbook = null;

        uploadBox.addEventListener('click', () => fileInput.click());
        uploadBox.addEventListener('dragover', (e) => { e.preventDefault(); uploadBox.style.borderColor = '#10b981'; });
        uploadBox.addEventListener('dragleave', () => { uploadBox.style.borderColor = '#64748b'; });
        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.style.borderColor = '#64748b';
            if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) handleFile(e.target.files[0]);
        });

        async function handleFile(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                workbook = XLSX.read(arrayBuffer, { type: 'array', cellStyles: true });

                // é¡¯ç¤ºåŸºæœ¬è³‡è¨Š
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('sheetCount').textContent = workbook.SheetNames.length;
                document.getElementById('sheetNames').textContent = workbook.SheetNames.join(', ');

                // å¡«å……å·¥ä½œè¡¨é¸æ“‡å™¨
                const selector = document.getElementById('sheetSelector');
                const productSelector = document.getElementById('productSheetSelector');

                const options = workbook.SheetNames.map(name =>
                    `<option value="${name}">${name}</option>`
                ).join('');

                selector.innerHTML = options;
                productSelector.innerHTML = options;

                selector.addEventListener('change', () => displaySheet(selector.value));
                productSelector.addEventListener('change', () => displayProductNames(productSelector.value));

                // é¡¯ç¤ºç¬¬ä¸€å€‹å·¥ä½œè¡¨
                displaySheet(workbook.SheetNames[0]);
                displayProductNames(workbook.SheetNames[0]);
                analyzeStructure();

                document.getElementById('results').style.display = 'block';

            } catch (error) {
                alert('è§£æå¤±æ•—ï¼š' + error.message);
                console.error(error);
            }
        }

        function displaySheet(sheetName) {
            const worksheet = workbook.Sheets[sheetName];
            const data = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });

            // é¡¯ç¤ºè¡¨æ ¼
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');

            if (data.length === 0) {
                thead.innerHTML = '';
                tbody.innerHTML = '<tr><td>æ­¤å·¥ä½œè¡¨ç‚ºç©º</td></tr>';
                return;
            }

            // å»ºç«‹è¡¨é ­ï¼ˆä½¿ç”¨ç¬¬ä¸€è¡Œï¼‰
            thead.innerHTML = `<tr>${data[0].map((cell, i) =>
                `<th>æ¬„ ${String.fromCharCode(65 + i)} - ${cell || '(ç©º)'}</th>`
            ).join('')}</tr>`;

            // å»ºç«‹è¡¨èº«ï¼ˆé¡¯ç¤ºå‰100è¡Œï¼‰
            tbody.innerHTML = data.slice(1, 101).map((row, i) => `
                <tr>
                    ${row.map(cell => `<td>${cell || '<span style="color:#64748b;">(ç©º)</span>'}</td>`).join('')}
                </tr>
            `).join('');
        }

        function displayProductNames(sheetName) {
            const worksheet = workbook.Sheets[sheetName];
            const range = XLSX.utils.decode_range(worksheet['!ref'] || 'A1');

            const products = [];

            // æå–åˆ—Açš„æ‰€æœ‰å…§å®¹ï¼ˆå¾ç¬¬1è¡Œåˆ°æœ€å¾Œä¸€è¡Œï¼‰
            for (let row = 0; row <= range.e.r; row++) {
                const cellAddress = `A${row + 1}`;
                const cell = worksheet[cellAddress];

                if (cell && cell.v) {
                    const value = String(cell.v).trim();
                    if (value) {
                        products.push({
                            row: row + 1,
                            name: value
                        });
                    }
                }
            }

            // é¡¯ç¤ºå•†å“åç¨±æ¸…å–®
            const productList = document.getElementById('productList');

            if (products.length === 0) {
                productList.innerHTML = '<p style="color: #94a3b8;">åˆ—Aç„¡è³‡æ–™</p>';
                return;
            }

            productList.innerHTML = `
                <p style="color: #10b981; margin-bottom: 10px;"><strong>æ‰¾åˆ° ${products.length} å€‹é …ç›®</strong></p>
                <table style="width: 100%; font-size: 0.9em;">
                    <thead>
                        <tr style="border-bottom: 1px solid #475569;">
                            <th style="padding: 8px; text-align: left; width: 80px;">åˆ—è™Ÿ</th>
                            <th style="padding: 8px; text-align: left;">å•†å“åç¨±</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${products.map(p => `
                            <tr style="border-bottom: 1px solid #334155;">
                                <td style="padding: 8px; color: #94a3b8;">A${p.row}</td>
                                <td style="padding: 8px;">${escapeHtml(p.name)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            console.log('åˆ—Aå•†å“åç¨±:', products);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function analyzeStructure() {
            const analysis = {
                sheets: {},
                summary: {}
            };

            workbook.SheetNames.forEach(sheetName => {
                const worksheet = workbook.Sheets[sheetName];
                const range = XLSX.utils.decode_range(worksheet['!ref'] || 'A1');
                const data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                // åˆ†ææ¯å€‹å·¥ä½œè¡¨
                analysis.sheets[sheetName] = {
                    ç¯„åœ: worksheet['!ref'],
                    ç¸½è¡Œæ•¸: range.e.r + 1,
                    ç¸½åˆ—æ•¸: range.e.c + 1,
                    æœ‰è³‡æ–™è¡Œæ•¸: data.length,
                    ç¬¬ä¸€è¡Œå…§å®¹: data[0] || [],
                    éç©ºå„²å­˜æ ¼çµ±è¨ˆ: analyzeContent(worksheet)
                };
            });

            analysis.summary = {
                å·¥ä½œè¡¨ç¸½æ•¸: workbook.SheetNames.length,
                å·¥ä½œè¡¨åˆ—è¡¨: workbook.SheetNames
            };

            document.getElementById('analysisResult').textContent = JSON.stringify(analysis, null, 2);
        }

        function analyzeContent(worksheet) {
            const stats = {
                ç¸½å„²å­˜æ ¼æ•¸: 0,
                éç©ºå„²å­˜æ ¼æ•¸: 0,
                åŒ…å«æ•¸å­—çš„å„²å­˜æ ¼: 0,
                åŒ…å«æ–‡å­—çš„å„²å­˜æ ¼: 0
            };

            for (let cell in worksheet) {
                if (cell[0] === '!') continue; // è·³éå…ƒè³‡æ–™

                stats.ç¸½å„²å­˜æ ¼æ•¸++;
                const cellData = worksheet[cell];

                if (cellData.v !== undefined && cellData.v !== '') {
                    stats.éç©ºå„²å­˜æ ¼æ•¸++;

                    if (typeof cellData.v === 'number') {
                        stats.åŒ…å«æ•¸å­—çš„å„²å­˜æ ¼++;
                    } else if (typeof cellData.v === 'string') {
                        stats.åŒ…å«æ–‡å­—çš„å„²å­˜æ ¼++;
                    }
                }
            }

            return stats;
        }
    </script>
</body>

</html>